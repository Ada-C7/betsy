<h1>Order Fulfillment</h1>

<h5>Paid Orders (<%= @merchant_orders["paid"].count %>) |
  Shipped Orders (<%= @merchant_orders["shipped"].count %>) |
  Cancelled Orders (<%= @merchant_orders["cancelled"].count %>)</h5>

<p> Total revenue: </p>

<% @merchant_orders.each do |status, orders| %>
  <section class="row orders">
    <h3><%= status.capitalize %> Orders (<%= orders.count %>)</h3>
    <ul>
      <% orders.each do |order_id, ops| %>
        <li>
          <h5><%= "Order ##{order_id}" %></h5>
          <p><%="Placed on #{Order.find_by(id: order_id).created_at.strftime("%b %e, %Y")}"%></p>
          <p>Revenue: $<%=Order.find_by(id: order_id).total %></p>

          <table>
            <tbody>
              <% ops.each do |op| %>
                <tr>
                  <td><%= op.product.name %> <%= image_tag op.product.photo_url, class: "product-image" %></td>
                  <td><%= op.quantity %></td>
                  <td><%= "x" %></td>
                  <td>$<%= op.product.price %></td>
                  <td>$<%= op.subtotal %></td>
                </tr>
              <% end %>
              <tr><td></td><td></td><td></td><td class="total">Total: </td><td class="total"><%= "$#{Order.find_by(id: order_id).total}" %></td></tr>
            </tbody>
          </table>
          <% if status == "paid" %>
            <%= link_to "Ship", ship_order_path(order_id), method: :patch, class: "button" %>
          <% end %>
        </li>
      <% end %>
    </ul>
  </section>
<% end %>
