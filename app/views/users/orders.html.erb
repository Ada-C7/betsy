<%= render partial: "sidebar" %>

<h2>Orders</h2>
<% if @orders.empty? %>
  <p>You have no orders.</p>
<% else %>
  <table>
    <thead>
      <tr>
        <th>Order</th>
        <th>Date</th>
        <th>Product</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Subtotal</th>
        <th>Item Status</th>
        <th>Order Total</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <% @orders.each do |order| %>
        <% order.order_items.each_with_index do |order_item, index| %>
          <tr>
            <td><%= link_to(order.id, order_path(order.id)) if index == 0 %></td>
            <td><%= order.created_at if index == 0 %></td>
              <% next unless @order_items.include? order_item %>
              <td><%= link_to order_item.product.name, product_path(order_item.product.id) %></td>
              <td><%= order_item.product.price %></td>
              <td><%= order_item.quantity %></td>
              <td><%= order_item.quantity * order_item.product.price %></td>
              <td>
                <% if order_item.shipped == "shipped" %>
                  "Shipped"
                <% elsif order_item.shipped == "cancelled" %>
                  "Cancelled"
                <% else %>
                  <%= link_to("Mark Shipped") %>&nbsp;&nbsp;
                  <%= link_to("Cancel") %>
                <% end %>
              </td>
            <td><%= @logged_in_user.order_revenue(order) if index == 0 %></td>
            <td><%= order.status.capitalize if index == 0 %></td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
<% end %>
